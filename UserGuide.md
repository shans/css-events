# Introduction #

This library is a pure Javascript emulator for CSS Events in the browser. It is not intended to be a high-performance library, but instead aims to provide a platform for experimenting with proposals for new CSS features.

## What are CSS Events? ##

CSS Events are events that are generated in response to CSS changes - for example, when the set of elements that matches a style rule changes, or when the content of a style rule changes, or even when the set of style rules matched by an element changes.

## Why are they useful? ##

The CSS standards body has recently started looking at a large number of new features for CSS. Implementations of these features are desirable as test beds for the viability and usefulness of the ideas proposed. Some of these (like Hierarchies and Variables) can be emulated in-browser using a parser/rewriter - see for example [experimental-css](http://code.google.com/p/experimental-css/), but others (like the [animation proposal](http://css-events.googlecode.com/git/examples/animation/index.html) released with this library) require deeper introspection of CSS state within the browser. Exposing this state as a set of events neatly separates the code required to emulate a proposed new feature from the code required to weld that feature into the browser, and makes rapid prototyping of new features in pure javascript feasible.

# Using the Library #

To use the library, simply import the `css-events.js` file into your HTML document using a `<script>` tag. Note that the library will add any existing stylesheets and DOM elements to the set of tracked objects on import, so if you want to make use of the library without first calling `addElementTree` and `styleSheetChanged` on any objects you wish to track, then import the library at the end of your document.

Importing the library will create a `window.CSSEmu` object which contains functions that allow manipulation of library state.

The library will only generate events for or involving tracked objects, so make sure that any elements and styles you wish to receive events for are tracked, either by including the library at the end of the document as mentioned above, or by explicitly calling `CSSEmu.addElementTree` and `CSSEmu.styleSheetChanged` as appropriate.

# Phantom Properties #

This library supports the registration and tracking (via events) of _phantom properties_ - property names that do not exist in CSS. This allows experimenters to readily track new CSS features simply by adding a phantom property representing that feature to the relevant style rules.

Phantom properties are registered via the `CSSEmu.addPhantomStyle` function. Note that phantom properties do not inherit.

It is possible to use a CSS parser such as [experimental-css](http://code.google.com/p/experimental-css) to parse css-like documents and automatically insert phantom properties where unrecognised or new properties are encountered. See [this example](http://css-events.googlecode.com/git/examples/animation/index.html) for a demonstration of this approach.

# Supported Events #

## MatchedCSSRulesChanged Events ##

These events are generated when the set of rules that match a given element change. For example, given the following CSS and HTML:

```
<style>
.foo {
  color: red;
}

.foo:hover {
  color: green;
}

.bar {
  background-color: black;
}
</style>
<div id="test-div" class="foo">
...
</div>
```

If a MatchedCSSRulesChanged handler was installed that listened to events generated on _test-div_, then that handler would receive an event if:
  * the user hovered over _test-div_
  * _test-div_ was added to class _bar_
  * _test-div_ was removed from class _foo_

In each case, the set of matched rules changes, and the event delivered to the handler reflects this change in the `oldStyle` and `newStyle` event attributes, which contain lists of the previously matched and currently matched styles, respectively.

MatchedCSSRulesChanged handlers can be registered by setting the `onMatchedCSSRulesChanged` attribute of tracked DOM objects, as well as by making use of the `window.addMatchedCSSRulesChangedHandler` function.

## ComputedStyleChanged Events ##

ComputedStyleChanged events are generated whenever the computed style of a target element changes. In general, computedStyleChanged events accompany matchedCSSRulesChanged event, because computed style changes tend to be generated by changes to the set of matched CSS rules. However, not every matchedCSSRulesChanged event generates a computedStyleChanged event, as it is possible to change the set of matched CSS rules without having any impact on computed style.

A ComputedStyleChanged event contains a reference to the old computed style in the `oldStyle` attribute, and the new computed style in the `newStyle` attribute.

ComputedStyleChanged handlers can be registered by setting the `onComputedStyleChanged` attribute of tracked DOM objects, as well as by making use of the `window.addComputedStyleChangedHandler` function.

## StyleRuleChanged Events ##

**Note that there is only partial support for this feature.**

StyleRuleChanged events are generated whenever the set of property-value pairs encoded within a target style rule changes.  Note, however, that this library currently only generates StyleRuleChanged events for phantom properties, not standard CSS properties.

A StyleRuleChanged event contains a reference to the StyleRule before and after the change (in the `oldStyle` and `newStyle` attributes, respectively), as well as a list of properties that have values that have changed (in the `changedProperties` attribute).

StyleRuleChanged handlers can be registered making use of the `window.addStyleRuleChangedHandler` function. Support is planned for a per-styleRule `onStyleRuleChanged` attribute, but not yet implemented.

## SelectedSetChanged Events ##

**Note that this feature is not currently implemented.**

SelectedSetChanged events will be generated whenever the set of elements matched by a given style rule changes.